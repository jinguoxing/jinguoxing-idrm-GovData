# 完整业务流程说明

## 一、整体业务流程图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        数据发现到业务对象生成完整流程                        │
└─────────────────────────────────────────────────────────────────────────────┘

【起点】数据源管理 (BU-01)
    │
    ├─ 连接数据源（MySQL、Oracle、PostgreSQL等）
    │
    ↓
【步骤1】资产扫描 (BU-02)
    │
    ├─ 扫描物理表结构
    ├─ 提取表名、字段、注释等信息
    │
    ↓
【步骤2】逻辑视图 - 语义理解 (BU-03) ⭐ 核心入口
    │
    ├─ AI 语义分析
    │   ├─ 分析表名、字段名、注释
    │   ├─ 识别业务语义
    │   ├─ 生成业务名称建议
    │   └─ 计算置信度
    │
    ├─ 字段语义识别
    │   ├─ 标识字段（主键）
    │   ├─ 关联字段（外键）
    │   ├─ 属性字段
    │   ├─ 状态字段
    │   └─ 时间戳字段
    │
    ├─ 三种生成路径（根据置信度智能路由）：
    │
    │   ┌─────────────────────────────────────────────────────────┐
    │   │ 路径A：一键生成（置信度 > 0.9，2步完成）                │
    │   │                                                          │
    │   │  逻辑视图 → [一键生成业务对象] → 业务对象建模            │
    │   │            ↑ 绿色按钮，推荐                            │
    │   │            └─ 跳过确认步骤，直接生成                    │
    │   └─────────────────────────────────────────────────────────┘
    │
    │   ┌─────────────────────────────────────────────────────────┐
    │   │ 路径B：快速生成（置信度 0.7-0.9，3步完成）               │
    │   │                                                          │
    │   │  逻辑视图 → 识别结果确认 → 业务对象建模                  │
    │   │            ↑ 蓝色按钮                                   │
    │   │            └─ 使用3步向导，快速确认后生成               │
    │   └─────────────────────────────────────────────────────────┘
    │
    │   ┌─────────────────────────────────────────────────────────┐
    │   │ 路径C：完整流程（置信度 < 0.7，3-4步完成）               │
    │   │                                                          │
    │   │  逻辑视图 → 识别结果确认 → [候选建议] → 业务对象建模     │
    │   │            ↑ 紫色按钮                                   │
    │   │            └─ 详细确认，可使用候选建议                  │
    │   └─────────────────────────────────────────────────────────┘
    │
    ↓
【步骤3】识别结果确认 (BU-05) ⭐ 增强功能
    │
    ├─ 识别任务概览（overview）
    │   ├─ 统计卡片：总表数、已接受、待确认、冲突、平均置信度
    │   ├─ 快速操作：识别结果对比、批量确认、冲突解释
    │   └─ 结果预览表：所有识别结果的列表
    │
    ├─ 识别结果对比（comparison）⭐ 可生成业务对象
    │   ├─ 左侧：数据来源结构（表列表）
    │   ├─ 右侧：语义建议区
    │   │   ├─ 表级对象建议（名称、置信度、来源）
    │   │   ├─ 字段级语义分类（标识、关联、属性等）
    │   │   ├─ 字段高亮关联
    │   │   ├─ 审计追踪信息
    │   │   ├─ 【生成业务对象按钮】⭐
    │   │   └─ 【AI候选建议】（辅助功能）⭐
    │   └─ 操作：接受/拒绝/编辑识别结果
    │
    ├─ 批量确认（batch）⭐ 可批量生成业务对象
    │   ├─ 筛选和过滤
    │   ├─ 批量选择
    │   ├─ 批量接受/拒绝
    │   └─ 【批量生成业务对象按钮】⭐
    │
    ├─ 冲突解释（conflict）⭐ 解决后可生成业务对象
    │   ├─ 左侧：规则判断
    │   ├─ 中间：AI判断
    │   ├─ 右侧：用户决策
    │   ├─ 冲突解决流程
    │   └─ 【生成业务对象按钮】（冲突解决后显示）⭐
    │
    ├─ 3步生成向导（GenerateBusinessObjectWizard）⭐
    │   ├─ 步骤1：基本信息确认
    │   │   ├─ 业务对象名称（可编辑）
    │   │   ├─ 业务对象编码（自动生成，可编辑）
    │   │   ├─ 业务描述（自动填充，可编辑）
    │   │   └─ 来源表（只读）
    │   │
    │   ├─ 步骤2：字段映射预览
    │   │   ├─ 物理字段 → 业务属性映射表
    │   │   ├─ 语义角色自动标注
    │   │   ├─ 字段类型自动转换
    │   │   ├─ 支持选择/取消字段
    │   │   └─ 支持编辑字段名称和类型
    │   │
    │   ├─ 步骤3：生成选项
    │   │   ├─ 是否立即发布
    │   │   ├─ 是否创建映射关系
    │   │   ├─ 是否发送通知
    │   │   └─ 业务域选择
    │   │
    │   ├─ 生成过程反馈
    │   │   ├─ 创建业务对象定义
    │   │   ├─ 创建业务属性
    │   │   ├─ 建立字段映射关系
    │   │   ├─ 创建数据血缘
    │   │   └─ 记录操作日志
    │   │
    │   └─ 生成成功提示
    │       ├─ 显示生成结果摘要
    │       ├─ 查看详情按钮
    │       └─ 自动跳转到业务对象建模页
    │
    ↓
【步骤4】业务对象建模 (TD-03) ⭐ 最终目标
    │
    ├─ 左侧：业务对象列表
    │   └─ 新创建的对象会高亮显示（"新创建"徽章，3秒后消失）
    │
    ├─ 右侧：业务对象详情
    │   ├─ 数据结构（Fields）
    │   ├─ 关系图谱（Relations）
    │   └─ 编辑和完善业务对象
    │
    └─ 自动定位：生成后自动选中新创建的业务对象
```

---

## 二、三种主要路径详解

### 路径A：一键生成（推荐，高置信度结果）

**适用场景**：AI语义分析的置信度 > 0.9，识别结果质量高

**流程步骤**：
1. **逻辑视图（BU-03）**
   - 完成AI语义分析
   - 查看语义理解结果
   - 系统显示：绿色"一键生成业务对象"按钮
   - 提示："置信度较高，可直接生成"

2. **一键生成**
   - 点击"一键生成业务对象"按钮
   - 使用默认配置自动生成：
     - 业务对象名称：从语义结果获取
     - 业务对象编码：自动生成（`biz_表名`）
     - 字段映射：自动转换（跳过时间戳字段）
     - 生成选项：默认配置
   - 显示生成进度动画
   - 生成成功提示

3. **业务对象建模（TD-03）**
   - 自动跳转到业务对象建模页
   - 自动定位到新创建的业务对象
   - 高亮显示"新创建"徽章
   - 用户可继续编辑和完善

**优点**：
- ✅ 步骤最少（仅2步）
- ✅ 操作最简单
- ✅ 效率最高
- ✅ 适合批量处理高置信度结果

---

### 路径B：快速生成（中等置信度结果）

**适用场景**：AI语义分析的置信度 0.7-0.9，识别结果质量中等

**流程步骤**：
1. **逻辑视图（BU-03）**
   - 完成AI语义分析
   - 查看语义理解结果
   - 系统显示：蓝色"快速生成业务对象"按钮
   - 提示："置信度中等，建议快速生成"

2. **识别结果确认（BU-05）**
   - 点击"快速生成业务对象"按钮
   - 打开3步生成向导
   - 步骤1：确认基本信息（名称、编码、描述）
   - 步骤2：确认字段映射（可选择字段、编辑名称和类型）
   - 步骤3：设置生成选项（发布、映射、通知等）
   - 点击"确认生成"

3. **生成过程**
   - 显示5步骤进度动画
   - 生成成功提示

4. **业务对象建模（TD-03）**
   - 点击"查看详情"自动跳转
   - 自动定位到新创建的业务对象
   - 高亮显示"新创建"徽章

**优点**：
- ✅ 步骤适中（3步）
- ✅ 可在生成前调整和确认
- ✅ 平衡了效率和可控性

---

### 路径C：完整流程（低置信度或复杂场景）

**适用场景**：
- AI语义分析的置信度 < 0.7
- 需要人工详细审核
- 存在冲突需要解决
- 需要查看候选建议

**流程步骤**：
1. **逻辑视图（BU-03）**
   - 完成AI语义分析
   - 查看语义理解结果
   - 系统显示：紫色"生成业务对象向导"按钮
   - 提示："置信度较低，建议使用向导"
   - 或者点击"识别结果确认"按钮进入详细确认

2. **识别结果确认（BU-05）**

   **方式1：识别结果对比**
   - 查看识别结果详情
   - 确认表级对象建议
   - 确认字段级语义分类
   - 查看AI候选建议（辅助功能）⭐
   - 点击"生成业务对象"按钮

   **方式2：批量确认**
   - 筛选和选择多个识别结果
   - 批量接受/拒绝
   - 点击"批量生成业务对象"按钮

   **方式3：冲突解释**
   - 查看规则判断和AI判断
   - 用户决策（采用规则/AI/手动指定）
   - 解决冲突
   - 冲突解决后显示"生成业务对象"按钮

3. **生成向导或候选建议**
   - 使用3步生成向导（同上）
   - 或者使用AI候选建议功能（辅助功能）⭐
     - 点击"查看候选建议"按钮
     - 查看AI生成的候选建议
     - 可采纳建议生成，或忽略

4. **业务对象建模（TD-03）**
   - 自动跳转和定位
   - 编辑和完善业务对象

**优点**：
- ✅ 流程最完整
- ✅ 可控性最高
- ✅ 适合复杂场景
- ✅ 提供候选建议辅助决策

---

## 三、关键功能点说明

### 1. 智能路由（根据置信度）

**位置**：逻辑视图（BU-03）

**逻辑**：
```typescript
if (置信度 > 0.9) {
    显示"一键生成业务对象"按钮（绿色，推荐）
    提示："置信度较高，可直接生成"
} else if (置信度 >= 0.7) {
    显示"快速生成业务对象"按钮（蓝色）
    提示："置信度中等，建议快速生成"
} else {
    显示"生成业务对象向导"按钮（紫色）
    提示："置信度较低，建议使用向导"
}
```

### 2. 3步生成向导

**位置**：识别结果确认页面（三个标签页均可触发）

**功能**：
- **步骤1**：基本信息确认（名称、编码、描述、来源表）
- **步骤2**：字段映射预览（选择字段、编辑名称和类型）
- **步骤3**：生成选项（发布、映射、通知、业务域）

**特点**：
- 所见即所得
- 可编辑所有内容
- 实时验证
- 进度反馈

### 3. 一键生成功能

**位置**：逻辑视图（BU-03）

**特点**：
- 跳过向导步骤
- 使用默认配置
- 自动字段映射
- 快速生成（约800ms）

### 4. 候选建议（辅助功能）

**位置**：识别结果对比页（BU-05）

**特点**：
- 按需显示（点击"查看候选建议"按钮）
- 不阻塞主流程
- 提供备选名称建议
- 可采纳或忽略

### 5. 生成成功后的交互

**功能**：
- 显示生成结果摘要
- 自动跳转到业务对象建模页
- 自动定位到新创建的业务对象
- 高亮显示"新创建"徽章（3秒后消失）

**实现方式**：
- 使用CustomEvent传递业务对象ID
- 业务对象建模页监听事件并自动选中

---

## 四、数据流转

### 数据来源

1. **资产扫描（BU-02）**
   - 输出：物理表结构（表名、字段、注释等）

2. **逻辑视图 - 语义理解（BU-03）**
   - 输入：物理表结构
   - 处理：AI语义分析
   - 输出：语义理解结果
     - `businessName`: 业务名称
     - `confidence`: 置信度
     - `coreFields`: 核心字段及语义角色
     - `description`: 业务描述
     - `clusterSuggestion`: 聚类建议
     - `scenarios`: 适用场景
     - `tags`: 业务标签

3. **识别结果确认（BU-05）**
   - 输入：语义理解结果
   - 处理：用户确认和调整
   - 输出：确认后的识别结果
     - `objectSuggestion`: 对象建议（名称、置信度、状态）
     - `fieldSuggestions`: 字段建议（字段、语义角色、状态）
     - `upgradeSuggestions`: 升级建议
     - `auditTrail`: 审计追踪

### 数据转换

**从识别结果到业务对象**：

```typescript
业务对象 = {
    id: `BO_${Date.now()}`,
    name: objectSuggestion.name,
    code: `biz_${tableName}`,
    domain: clusterSuggestion || 'AI生成',
    status: options.publishImmediately ? 'published' : 'draft',
    description: description,
    sourceTables: [tableName],
    fields: fieldSuggestions
        .filter(f => f.selected && !isTimestampField(f))
        .map(f => ({
            name: convertToCamelCase(f.field),
            code: f.field,
            type: convertPhysicalTypeToBusinessType(f.physicalType),
            desc: f.aiExplanation
        }))
}
```

### 数据传递

- **页面间传递**：通过React状态管理（props、state）
- **事件传递**：使用CustomEvent（生成后定位）
- **状态同步**：业务对象列表实时更新

---

## 五、用户体验优化

### 1. 流程简化
- **优化前**：4步流程，多次页面切换
- **优化后**：
  - 主要路径：3步
  - 快捷路径：2步
  - 减少25-50%的操作步骤

### 2. 智能路由
- 根据置信度自动推荐最佳路径
- 高置信度结果可快速处理
- 低置信度结果提供完整确认流程

### 3. 辅助功能
- 候选建议按需显示
- 不阻塞主流程
- 提供决策支持

### 4. 反馈机制
- 生成过程进度显示
- 生成成功明确提示
- 自动定位和高亮显示

### 5. 灵活性
- 支持向导生成和快捷生成
- 支持单个和批量生成
- 支持在多个入口生成

---

## 六、模块关联关系

```
数据源管理 (BU-01)
    ↓ (提供数据源)
资产扫描 (BU-02)
    ↓ (扫描表结构)
逻辑视图 (BU-03) ⭐ 核心入口
    ├─→ 一键生成 → 业务对象建模 (TD-03)
    ├─→ 快速生成 → 识别结果确认 (BU-05) → 业务对象建模 (TD-03)
    └─→ 识别结果确认 (BU-05)
            ├─→ 生成业务对象 → 业务对象建模 (TD-03)
            ├─→ 候选建议（辅助）→ 生成业务对象 → 业务对象建模 (TD-03)
            └─→ 候选生成 (BU-04)（可选，已改为辅助功能）
```

---

## 七、关键入口汇总

### 生成业务对象的入口

1. **逻辑视图（BU-03）**
   - 一键生成按钮（置信度 > 0.9）
   - 快速生成按钮（置信度 0.7-0.9）
   - 生成向导按钮（置信度 < 0.7）

2. **识别结果对比页（BU-05）**
   - 生成业务对象按钮

3. **批量确认页（BU-05）**
   - 批量生成业务对象按钮

4. **冲突解释页（BU-05）**
   - 生成业务对象按钮（冲突解决后显示）

5. **候选建议（辅助功能）**
   - 采纳候选建议生成按钮

---

## 八、总结

### 优化成果

1. **流程优化**
   - 主要路径：4步 → 3步（减少25%）
   - 快捷路径：4步 → 2步（减少50%）

2. **功能增强**
   - 3步生成向导：完整的预览和确认流程
   - 一键生成：高置信度结果快速处理
   - 候选建议：辅助决策，不阻塞流程

3. **用户体验**
   - 智能路由：根据置信度推荐最佳路径
   - 流程连贯：自动跳转和定位
   - 反馈清晰：进度显示和成功提示

4. **灵活性**
   - 多种生成方式（向导、快速、一键）
   - 多个生成入口
   - 辅助功能按需使用

### 核心价值

- ✅ **效率提升**：减少操作步骤，提高生成效率
- ✅ **质量保证**：提供预览和确认机制，确保生成质量
- ✅ **智能辅助**：根据置信度智能路由，候选建议辅助决策
- ✅ **用户体验**：流程连贯，反馈清晰，操作简单

---

**文档版本**：v1.0  
**最后更新**：2024年（完成三个阶段的优化后）  
**维护者**：开发团队

